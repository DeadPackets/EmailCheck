<html>

<head>
    <title>Index</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.1.0/css/hover-min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/components/accordion.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/components/accordion.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/index.js"></script>
</head>

<body class="animated fadeIn">
    <div id="container">
        <br />
        <form class="ui massive form" onsubmit="sendEmailRecon(this.email.value); return false">
            <div class="field">
                <label>Email</label>
                <input type="email" name="email" class="email" placeholder="johndoe@example.com">
            </div>
            <button class="ui button hvr-grow submit" type="submit">Submit</button>
        </form>
    </div>
    <div class="ui divider"></div>
</body>
<script>
    var searchedPreviously;
    $(function() {
        console.log("Page Loaded!")
        var emailurl = unescape(location.search.split("=")[1])
        if (emailurl) {
            $('.email').val(emailurl)
            $('.submit').addClass("disabled loading")
            sendEmailRecon(emailurl)
        }

        socket.on('done-results', function() {
            $('.submit').removeClass("disabled loading")
            console.log("test")
            searchedPreviously = 1
        })
    })

    $('.submit').click(function() {
        var email = $('.email').val()
        if (email == '') {} else {
            $(this).addClass("disabled loading")
        }
    })

    function sendEmailRecon(email) {
        if (searchedPreviously == 1) {
            e.preventDefaultBehavior()
        } else {
            if (email == '') {
                swal("Wait!", "Please provide an email!", 'error')
            } else {
                socket.emit('start-email-recon', email)
            }
            socket.on('psbdmp-results', function(data) {
                var result = JSON.parse(data)
                console.log(result)
            })
            socket.on('haveibeenpwned_breach-results', function(data) {
                if (data == false) {
                    console.log("No breach found.")
                } else {
                    var result = JSON.parse(data)
                    console.log(result)
                }
            })
            socket.on('haveibeenpwned_paste-results', function(data) {
                if (data == false) {
                    console.log("No paste found.")
                } else {
                    var result = JSON.parse(data)
                    console.log(result)
                }
            })
            socket.on('hacked-db-results', function(data) {
                var result = JSON.parse(data)
                console.log(result)
            })
        }
    }
</script>

</html>
