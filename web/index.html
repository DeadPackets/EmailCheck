<html>

<head>
    <title>Index</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.1.0/css/hover-min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/index.js"></script>
</head>

<body class="animated fadeIn">
    <div id="container">
        <br />
        <form class="ui massive form" onsubmit="sendEmailRecon(this.email.value); return false">
            <div class="field">
                <label>Email</label>
                <input type="email" name="email" class="email" placeholder="johndoe@example.com">
            </div>
            <button class="ui button hvr-grow submit" type="submit">Submit</button>
        </form>
    </div>
    <div class="ui divider"></div>
</body>
<script>
    var searchedPreviously;
    $(function() {
        console.log("Page Loaded!")
        if (!location.search) {} else {
            var emailurl = unescape(location.search.split("=")[1])
            $('.email').val(emailurl)
            $('.submit').addClass("disabled loading")
            sendEmailRecon(emailurl)
        }

        socket.on('done-results', function() {
            $('.submit').removeClass("disabled loading")
            searchedPreviously = 1
        })
    })

    $('.submit').click(function() {
        var email = $('.email').val()
        if (email == '') {} else {
            $(this).addClass("disabled loading")
        }
    })

    function sendEmailRecon(email) {
        if (searchedPreviously == 1) {
            e.preventDefaultBehavior()
        } else {

            if (email == '') {
                swal("Wait!", "Please provide an email!", 'error')
            } else {
                socket.emit('start-email-recon', email)
            }

            socket.on('psbdmp-results', function(data) {
                var result = JSON.parse(data)
                if (result.error > 0) {
                    console.log("Pastebin Dump Error!")
                } else {
                    if (result.count > 0) {
                        console.log(result.count + " pastes found in PSBDMP!")
                        for (var i = 0; i < result.data.length; i++) {
                            var id = result.data[i]["id"]
                            var time = result.data[i]["time"]
                        }
                    } else {
                        console.log("No pastes found in PSBDMP!")
                    }
                }
            })

            socket.on('haveibeenpwned_breach-results', function(data) {
                if (data == false) {
                    console.log("No breach found in HiBP_Breach!")
                } else {
                    var result = JSON.parse(data)
                    console.log(result.length + " breaches found in HiBP_Breach!")
                    for (var i = 0; i < result.length; i++) {
                        var breachtitle = result[i]["Title"]
                        var breachdate = result[i]["BreachDate"]
                        var description = result[i]["Description"]
                        var data_leaked = result[i]["DataClasses"]
                        var pwncount = result[i]["PwnCount"]
                        var isverified = result[i]["IsVerified"]
                        var breachdomain = result[i]["Domain"]
                    }
                }
            })

            socket.on('haveibeenpwned_paste-results', function(data) {
                if (data == false) {
                    console.log("No paste found in HiBP_Paste!")
                } else {
                    var result = JSON.parse(data)
                    console.log(result.length + " pastes found in HiBP_Paste!")
                    for (var i = 0; i < result.length; i++) {
                        var date = result[i]["Date"]
                        var emailcount = result[i]["EmailCount"]
                        var id = result[i]["Id"]
                        var source = result[i]["Source"]
                        var title = result[i]["Title"]
                    }
                }
            })

            socket.on('hacked-db-results', function(data) {
                var result = JSON.parse(data)
                if (result.result == false) {
                    console.log("No record in Hacked-DB!")
                } else {
                    console.log("Records exist in Hacked-DB!")
                }
            })

            socket.on('hacked-email-results', function(data) {
                var result = JSON.parse(data)
                if (result.status == "found") {
                    var no_of_leaks = result.results
                    console.log(no_of_leaks + " leaks found in Hacked-Emails!")
                    for (var i = 0; i < result.data.length; i++) {
                        var emails_count = result.data[i]["emails_count"]
                        var date = result.data[i]["data_leaked"]
                        var source_network = result.data[i]["source_network"]
                        var verified = result.data[i]["verified"]
                        var source_url = result.data[i]["source_url"]
                        var title = result.data[i]["title"]
                        var source_provider = result.data[i]["source_provider"]
                        var details = result.data[i]["details"]
                    }
                } else {
                    console.log("No record in Hacked-Emails!")
                }
            })
        }
    }
</script>

</html>
